<!DOCTYPE html>

<html lang="ko">
  <head>
    <link href="styles/theme-colors.css" rel="stylesheet" />
    <link href="styles/layout.css" rel="stylesheet" />
    <link href="styles/docs_required.css" rel="stylesheet" />
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>TaxSonic | 필요 서류 안내</title>
  </head>
  <body>
    <!-- Slide Menu -->
    <button aria-label="메뉴 열기" id="hamburgerBtn" type="button">☰</button>
    <div aria-hidden="true" id="drawerBackdrop"></div>
    <aside aria-label="슬라이드 메뉴" id="drawer">
      <div class="drawerHead">
        <div class="drawerTitle">메뉴</div>
        <button class="drawerClose" id="drawerClose" type="button">닫기</button>
      </div>
      <div class="drawerNav">
        <div class="drawerGroup">
          <div class="drawerGroupTitle">기본</div>
          <a href="service_main.html">메인</a>
          <a href="onboarding.html">이용 가이드</a>
          <a href="login.html">로그인</a>
        </div>
        <div class="drawerGroup">
          <div class="drawerGroupTitle">계산</div>
          <a href="quick_calc.html">간편 계산</a>
          <a href="detail_income.html">상세 계산</a>
        </div>
        <div class="drawerGroup">
          <div class="drawerGroupTitle">고객센터</div>
          <a href="board_qna.html">Q&amp;A</a>
          <a href="board_faq.html">FAQ</a>
        </div>
        <div class="drawerGroup" data-user-only="true">
          <div class="drawerGroupTitle">내 정보</div>
          <a href="mypage.html">마이페이지</a>
          <a href="member_history.html">기록 열람</a>
        </div>
        <div class="drawerGroup" data-admin-only="true">
          <div class="drawerGroupTitle">관리자</div>
          <a href="admin_tax_rates.html">세율/정책</a>
          <a href="admin_deduction_items.html">공제 항목</a>
          <a href="admin_analytics.html">로그 분석</a>
        </div>
      </div>
    </aside>
    <header>
      <div class="container header-inner">
        <div class="logo"><a href="service_main.html">TaxSonic</a></div>
        <nav>
          <a class="" href="onboarding.html">이용 가이드</a>
          <a class="" href="quick_calc.html">간편 계산</a>
          <a class="active" href="detail_income.html">상세 계산</a>
          <a class="" href="board_qna.html">Q&amp;A</a>
          <a class="" href="board_faq.html">FAQ</a>
          <a class="" href="login.html">로그인</a>
        </nav>
      </div>
    </header>
    <main class="container">
      <div class="h1">필요 서류 안내</div>
      <p class="p">
        항목별로 어떤 서류를 어떻게 준비하는지 예시로 정리했습니다. (데모)
      </p>
      <div class="grid">
        <div class="card">
          <div class="h3">월세 세액공제</div>
          <ul style="margin: 10px 0 0 18px; color: var(--sub); font-size: 14px">
            <li>임대차계약서 사본</li>
            <li>월세 이체 내역(계좌이체/현금영수증 등)</li>
            <li>주민등록등본(필요 시)</li>
          </ul>
        </div>
        <div class="card">
          <div class="h3">보험료 / 의료비</div>
          <ul style="margin: 10px 0 0 18px; color: var(--sub); font-size: 14px">
            <li>보험료 납입증명서</li>
            <li>의료비 영수증 / 진료비 납입확인서</li>
          </ul>
        </div>
        <div class="card">
          <div class="h3">IRP(퇴직연금)</div>
          <ul style="margin: 10px 0 0 18px; color: var(--sub); font-size: 14px">
            <li>납입 확인서</li>
            <li>금융기관 발급 증빙</li>
          </ul>
        </div>
        <div class="btnRow" style="justify-content: flex-end">
          <a class="btn" href="result_final.html">결과로 돌아가기</a>
        </div>
      </div>
    </main>
    <div
      id="emailModal"
      style="
        display: none;
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.35);
        align-items: center;
        justify-content: center;
        z-index: 1000;
      "
    >
      <div class="surface" style="max-width: 520px; width: 92%">
        <div class="h3">결과 이메일 전송</div>
        <p class="p">비로그인 사용자도 이메일 전송이 가능합니다.</p>
        <div class="field">
          <label>받는 이메일</label>
          <input placeholder="name@example.com" type="email" />
        </div>
        <div class="field">
          <label>전송 내용</label>
          <select>
            <option>요약 텍스트 + 링크</option>
            <option>PDF 첨부 + 링크</option>
          </select>
        </div>
        <div style="display: flex; justify-content: flex-end; gap: 10px">
          <button class="btn-ghost" onclick="closeEmail()">취소</button>
          <button
            class="btn-primary"
            onclick="alert('전송 요청(데모)'); closeEmail();"
          >
            전송
          </button>
        </div>
      </div>
    </div>
    <script>
      function openEmail() {
        document.getElementById("emailModal").style.display = "flex";
      }
      function closeEmail() {
        document.getElementById("emailModal").style.display = "none";
      }
    </script>
    <footer class="footer">© 2026 TaxSonic. All rights reserved.</footer>
    <script>
      (function () {
        const btn = document.getElementById("hamburgerBtn");
        const drawer = document.getElementById("drawer");
        const backdrop = document.getElementById("drawerBackdrop");
        const closeBtn = document.getElementById("drawerClose");

        function open() {
          drawer && drawer.classList.add("open");
          backdrop && backdrop.classList.add("open");
        }
        function close() {
          drawer && drawer.classList.remove("open");
          backdrop && backdrop.classList.remove("open");
        }
        btn && btn.addEventListener("click", open);
        closeBtn && closeBtn.addEventListener("click", close);
        backdrop && backdrop.addEventListener("click", close);
        // ===== Active highlight (drawer + header nav) =====
        const current = (location.pathname.split("/").pop() || "index.html")
          .split("?")[0]
          .split("#")[0];
        const allLinks = document.querySelectorAll("#drawer .drawerNav a");
        allLinks.forEach((a) => {
          const href = (a.getAttribute("href") || "").trim();
          if (href && href === current) {
            a.classList.add("active");
          }
        });
        const topNavLinks = document.querySelectorAll("header nav a");
        topNavLinks.forEach((a) => {
          const href = (a.getAttribute("href") || "").trim();
          if (href && href === current) {
            a.classList.add("active");
          }
        });

        // ===== Admin visibility (role-based, no toggle) =====
        function getUserRole() {
          const role =
            localStorage.getItem("taxsonic_user_role") ||
            localStorage.getItem("taxsonic_role") ||
            localStorage.getItem("role") ||
            "";
          return String(role).toLowerCase();
        }
        function isLoggedIn() {
          const v =
            localStorage.getItem("taxsonic_is_logged_in") ||
            localStorage.getItem("taxsonic_logged_in") ||
            localStorage.getItem("is_logged_in") ||
            "";
          const hasToken = !!(
            localStorage.getItem("taxsonic_token") ||
            localStorage.getItem("auth_token") ||
            localStorage.getItem("access_token")
          );
          const hasUser = !!(
            localStorage.getItem("taxsonic_user_id") ||
            localStorage.getItem("user_id") ||
            localStorage.getItem("username")
          );
          // If role is set, treat as logged-in for this static prototype.
          const role = getUserRole();
          return (
            v === "1" ||
            v === "true" ||
            hasToken ||
            hasUser ||
            role === "admin" ||
            role === "user"
          );
        }
        function getIsAdmin() {
          const role = getUserRole();
          const legacy = localStorage.getItem("taxsonic_is_admin") === "1"; // backward compat for older builds
          return role === "admin" || legacy;
        }
        function applyAdminVisibility() {
          const showAdmin = isLoggedIn() && getIsAdmin();
          document
            .querySelectorAll('[data-admin-only="true"]')
            .forEach((el) => {
              el.style.display = showAdmin ? "" : "none";
            });
        }
        applyAdminVisibility();

        // ===== Accordion groups =====
        function setCollapsed(group, collapsed) {
          if (!group) return;
          group.classList.toggle("is-collapsed", !!collapsed);
          const title = group.querySelector(".drawerGroupTitle");
          if (title) {
            title.setAttribute("aria-expanded", collapsed ? "false" : "true");
          }
        }

        const groups = Array.from(
          document.querySelectorAll("#drawer .drawerGroup")
        );
        groups.forEach((group) => {
          const title = group.querySelector(".drawerGroupTitle");
          if (!title) return;

          const name = title.textContent.trim();
          const key = "taxsonic_drawer_group_" + name;

          // make title behave like a button
          title.setAttribute("role", "button");
          title.setAttribute("tabindex", "0");

          const saved = localStorage.getItem(key);
          if (saved === "1") setCollapsed(group, true);

          const toggle = () => {
            const collapsed = group.classList.contains("is-collapsed");
            const next = !collapsed;
            setCollapsed(group, next);
            localStorage.setItem(key, next ? "1" : "0");
          };

          title.addEventListener("click", toggle);
          title.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              toggle();
            }
          });
        });

        // Ensure active link's group is open
        const active = document.querySelector("#drawer .drawerNav a.active");
        if (active) {
          const group = active.closest(".drawerGroup");
          if (group) {
            setCollapsed(group, false);
            const title = group.querySelector(".drawerGroupTitle");
            if (title) {
              const key = "taxsonic_drawer_group_" + title.textContent.trim();
              localStorage.setItem(key, "0");
            }
          }
        }
      })();
    </script>
    <script>
      (function () {
        function isLoggedIn() {
          return localStorage.getItem("taxsonic_is_logged_in") === "1";
        }
        function clearAuth() {
          localStorage.removeItem("taxsonic_is_logged_in");
          localStorage.removeItem("taxsonic_user_role");
          localStorage.removeItem("taxsonic_role");
          localStorage.removeItem("role");
          localStorage.removeItem("taxsonic_is_admin"); // legacy
        }

        function enhanceLoginLogoutLinks() {
          const links = Array.from(
            document.querySelectorAll(
              'a[href="login.html"], a[href="./login.html"]'
            )
          );
          if (!links.length) return;

          if (isLoggedIn()) {
            links.forEach((a) => {
              a.setAttribute("href", "#logout");
              a.textContent = "로그아웃";
              a.classList.add("logoutLink");
            });
            document.addEventListener("click", function (e) {
              const a = e.target.closest('a[href="#logout"]');
              if (!a) return;
              e.preventDefault();
              clearAuth();
              window.location.href = "index.html";
            });
          } else {
            links.forEach((a) => {
              a.textContent = "로그인";
              // keep href as login.html
            });
          }
        }

        document.addEventListener("DOMContentLoaded", enhanceLoginLogoutLinks);
      })();
    </script>
  </body>
</html>
