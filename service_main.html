<!DOCTYPE html>

<html lang="ko">
  <head>
    <link href="styles/theme-colors.css" rel="stylesheet" />
    <link href="styles/layout.css" rel="stylesheet" />
    <link href="styles/service_main.css" rel="stylesheet" />
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>TaxSonic | 연말정산을 쉽게</title>
  </head>
  <body>
    <!-- Slide Menu -->
    <button aria-label="메뉴 열기" id="hamburgerBtn" type="button">☰</button>
    <div aria-hidden="true" id="drawerBackdrop"></div>
    <aside aria-label="슬라이드 메뉴" id="drawer">
      <div class="drawerHead">
        <div class="drawerTitle">메뉴</div>
        <button class="drawerClose" id="drawerClose" type="button">닫기</button>
      </div>
      <div class="drawerNav">
        <div class="drawerGroup">
          <div class="drawerGroupTitle">기본</div>
          <a href="service_main.html">메인</a>
          <a href="onboarding.html">이용 가이드</a>
          <a href="login.html">로그인</a>
        </div>
        <div class="drawerGroup">
          <div class="drawerGroupTitle">계산</div>
          <a href="quick_calc.html">간편 계산</a>
          <a href="detail_income.html">상세 계산</a>
        </div>
        <div class="drawerGroup">
          <div class="drawerGroupTitle">고객센터</div>
          <a href="board_qna.html">Q&amp;A</a>
          <a href="board_faq.html">FAQ</a>
        </div>
        <div class="drawerGroup" data-user-only="true">
          <div class="drawerGroupTitle">내 정보</div>
          <a href="mypage.html">마이페이지</a>
          <a href="member_history.html">기록 열람</a>
        </div>
        <div class="drawerGroup" data-admin-only="true">
          <div class="drawerGroupTitle">관리자</div>
          <a href="admin_tax_rates.html">세율/정책</a>
          <a href="admin_deduction_items.html">공제 항목</a>
          <a href="admin_analytics.html">로그 분석</a>
        </div>
      </div>
    </aside>
    <header>
      <div class="container header-inner">
        <div class="logo"><a href="service_main.html">TaxSonic</a></div>
        <nav>
          <a href="onboarding.html">이용 가이드</a>
          <a class="" href="quick_calc.html">간편 계산</a>
          <a class="" href="detail_income.html">상세 계산</a>
          <a class="" href="board_qna.html">Q&amp;A</a>
          <a class="" href="board_faq.html">FAQ</a>
          <a class="" href="login.html">로그인</a>
        </nav>
      </div>
    </header>
    <main class="container">
      <section class="surface" style="text-align: center; padding: 44px 28px">
        <div class="h1">연말정산, 이제 쉽게 하세요</div>
        <p class="p">
          복잡한 세법과 공제 항목을 이해하지 않아도,<br />
          질문에 답하는 것만으로 나에게 맞는 연말정산 결과와 절세 방향을
          안내합니다.
        </p>
        <div
          style="
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 18px;
          "
        >
          <a class="btn-ghost" href="quick_calc.html">연말정산 시작하기</a>
        </div>
      </section>
      <section style="padding: 32px 0 0">
        <div class="grid grid-2">
          <div class="card">
            <div class="h3">간편 계산</div>
            <p class="p">
              나이와 총급여액만 입력해도 평균 환급액과 주요 공제 가능성을 확인할
              수 있습니다.
            </p>
            <a class="btn-primary btn-small" href="quick_calc.html"
              >바로 시작</a
            >
          </div>
          <div class="card">
            <div class="h3">상세 계산</div>
            <p class="p">
              소득공제 → 세액공제를 단계별로 입력해 더 정확한 환급·추납 금액과
              맞춤 솔루션을 제공합니다.
            </p>
            <a class="btn-ghost btn-small" href="detail_income.html"
              >상세 계산</a
            >
          </div>
          <div class="card">
            <div class="h3">Q&amp;A</div>
            <p class="p">
              사용 중 막히는 부분을 질문하면 관리자가 댓글로 답변해드립니다.
            </p>
            <a class="btn-ghost btn-small" href="board_qna.html">질문하기</a>
          </div>
          <div class="card">
            <div class="h3">FAQ</div>
            <p class="p">
              자주 묻는 질문과 핵심 개념을 빠르게 확인할 수 있습니다.
            </p>
            <a class="btn-ghost btn-small" href="board_faq.html">FAQ 보기</a>
          </div>
        </div>
      </section>
    </main>
    <footer class="footer">© 2026 TaxSonic. All rights reserved.</footer>
    <script>
      (function () {
        const btn = document.getElementById("hamburgerBtn");
        const drawer = document.getElementById("drawer");
        const backdrop = document.getElementById("drawerBackdrop");
        const closeBtn = document.getElementById("drawerClose");

        function open() {
          drawer && drawer.classList.add("open");
          backdrop && backdrop.classList.add("open");
        }
        function close() {
          drawer && drawer.classList.remove("open");
          backdrop && backdrop.classList.remove("open");
        }
        btn && btn.addEventListener("click", open);
        closeBtn && closeBtn.addEventListener("click", close);
        backdrop && backdrop.addEventListener("click", close);
        // ===== Active highlight (drawer + header nav) =====
        const current = (location.pathname.split("/").pop() || "index.html")
          .split("?")[0]
          .split("#")[0];
        const allLinks = document.querySelectorAll("#drawer .drawerNav a");
        allLinks.forEach((a) => {
          const href = (a.getAttribute("href") || "").trim();
          if (href && href === current) {
            a.classList.add("active");
          }
        });
        const topNavLinks = document.querySelectorAll("header nav a");
        topNavLinks.forEach((a) => {
          const href = (a.getAttribute("href") || "").trim();
          if (href && href === current) {
            a.classList.add("active");
          }
        });

        // ===== Admin visibility (role-based, no toggle) =====
        function getUserRole() {
          const role =
            localStorage.getItem("taxsonic_user_role") ||
            localStorage.getItem("taxsonic_role") ||
            localStorage.getItem("role") ||
            "";
          return String(role).toLowerCase();
        }
        function isLoggedIn() {
          const v =
            localStorage.getItem("taxsonic_is_logged_in") ||
            localStorage.getItem("taxsonic_logged_in") ||
            localStorage.getItem("is_logged_in") ||
            "";
          const hasToken = !!(
            localStorage.getItem("taxsonic_token") ||
            localStorage.getItem("auth_token") ||
            localStorage.getItem("access_token")
          );
          const hasUser = !!(
            localStorage.getItem("taxsonic_user_id") ||
            localStorage.getItem("user_id") ||
            localStorage.getItem("username")
          );
          // If role is set, treat as logged-in for this static prototype.
          const role = getUserRole();
          return (
            v === "1" ||
            v === "true" ||
            hasToken ||
            hasUser ||
            role === "admin" ||
            role === "user"
          );
        }
        function getIsAdmin() {
          const role = getUserRole();
          const legacy = localStorage.getItem("taxsonic_is_admin") === "1"; // backward compat for older builds
          return role === "admin" || legacy;
        }
        function applyAdminVisibility() {
          const showAdmin = isLoggedIn() && getIsAdmin();
          document
            .querySelectorAll('[data-admin-only="true"]')
            .forEach((el) => {
              el.style.display = showAdmin ? "" : "none";
            });
        }
        applyAdminVisibility();

        // ===== User-only visibility (logged-in user only; admin 제외) =====
        function applyUserVisibility() {
          const role = getUserRole();
          const showUser = isLoggedIn() && role === "user";
          document.querySelectorAll('[data-user-only="true"]').forEach((el) => {
            el.style.display = showUser ? "" : "none";
          });
        }
        applyUserVisibility(); // ===== Accordion groups =====
        function setCollapsed(group, collapsed) {
          if (!group) return;
          group.classList.toggle("is-collapsed", !!collapsed);
          const title = group.querySelector(".drawerGroupTitle");
          if (title) {
            title.setAttribute("aria-expanded", collapsed ? "false" : "true");
          }
        }

        const groups = Array.from(
          document.querySelectorAll("#drawer .drawerGroup")
        );
        groups.forEach((group) => {
          const title = group.querySelector(".drawerGroupTitle");
          if (!title) return;

          const name = title.textContent.trim();
          const key = "taxsonic_drawer_group_" + name;

          // make title behave like a button
          title.setAttribute("role", "button");
          title.setAttribute("tabindex", "0");

          const saved = localStorage.getItem(key);
          if (saved === "1") setCollapsed(group, true);

          const toggle = () => {
            const collapsed = group.classList.contains("is-collapsed");
            const next = !collapsed;
            setCollapsed(group, next);
            localStorage.setItem(key, next ? "1" : "0");
          };

          title.addEventListener("click", toggle);
          title.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              toggle();
            }
          });
        });

        // Ensure active link's group is open
        const active = document.querySelector("#drawer .drawerNav a.active");
        if (active) {
          const group = active.closest(".drawerGroup");
          if (group) {
            setCollapsed(group, false);
            const title = group.querySelector(".drawerGroupTitle");
            if (title) {
              const key = "taxsonic_drawer_group_" + title.textContent.trim();
              localStorage.setItem(key, "0");
            }
          }
        }
      })();
    </script>
    <script>
      (function () {
        function isLoggedIn() {
          return localStorage.getItem("taxsonic_is_logged_in") === "1";
        }
        function clearAuth() {
          localStorage.removeItem("taxsonic_is_logged_in");
          localStorage.removeItem("taxsonic_user_role");
          localStorage.removeItem("taxsonic_role");
          localStorage.removeItem("role");
          localStorage.removeItem("taxsonic_is_admin"); // legacy
        }

        function enhanceLoginLogoutLinks() {
          const links = Array.from(
            document.querySelectorAll(
              'a[href="login.html"], a[href="./login.html"]'
            )
          );
          if (!links.length) return;

          if (isLoggedIn()) {
            links.forEach((a) => {
              a.setAttribute("href", "#logout");
              a.textContent = "로그아웃";
              a.classList.add("logoutLink");
            });
            document.addEventListener("click", function (e) {
              const a = e.target.closest('a[href="#logout"]');
              if (!a) return;
              e.preventDefault();
              clearAuth();
              window.location.href = "index.html";
            });
          } else {
            links.forEach((a) => {
              a.textContent = "로그인";
              // keep href as login.html
            });
          }
        }

        document.addEventListener("DOMContentLoaded", enhanceLoginLogoutLinks);
      })();
    </script>
  </body>
</html>
