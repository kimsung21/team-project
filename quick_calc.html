<!DOCTYPE html>

<html lang="ko">
  <head>
    <link href="styles/theme-colors.css" rel="stylesheet" />
    <link href="styles/layout.css" rel="stylesheet" />
    <link href="styles/quick_calc.css" rel="stylesheet" />
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>TaxSonic | 간편 연말정산 계산</title>
  </head>
  <body>
    <!-- Slide Menu -->
    <button aria-label="메뉴 열기" id="hamburgerBtn" type="button">☰</button>
    <div aria-hidden="true" id="drawerBackdrop"></div>
    <aside aria-label="슬라이드 메뉴" id="drawer">
      <div class="drawerHead">
        <div class="drawerTitle">메뉴</div>
        <button class="drawerClose" id="drawerClose" type="button">닫기</button>
      </div>
      <div class="drawerNav">
        <div class="drawerGroup">
          <div class="drawerGroupTitle">기본</div>
          <a href="service_main.html">메인</a>
          <a href="onboarding.html">이용 가이드</a>
          <a href="login.html">로그인</a>
        </div>
        <div class="drawerGroup">
          <div class="drawerGroupTitle">계산</div>
          <a href="quick_calc.html">간편 계산</a>
          <a href="detail_income.html">상세 계산</a>
        </div>
        <div class="drawerGroup">
          <div class="drawerGroupTitle">고객센터</div>
          <a href="board_qna.html">Q&amp;A</a>
          <a href="board_faq.html">FAQ</a>
        </div>
        <div class="drawerGroup" data-user-only="true">
          <div class="drawerGroupTitle">내 정보</div>
          <a href="mypage.html">마이페이지</a>
          <a href="member_history.html">기록 열람</a>
        </div>
        <div class="drawerGroup" data-admin-only="true">
          <div class="drawerGroupTitle">관리자</div>
          <a href="admin_tax_rates.html">세율/정책</a>
          <a href="admin_deduction_items.html">공제 항목</a>
          <a href="admin_analytics.html">로그 분석</a>
        </div>
      </div>
    </aside>
    <header>
      <div class="container header-inner">
        <div class="logo"><a href="service_main.html">TaxSonic</a></div>
        <nav>
          <a class="" href="onboarding.html">이용 가이드</a>
          <a class="active" href="quick_calc.html">간편 계산</a>
          <a class="" href="detail_income.html">상세 계산</a>
          <a class="" href="board_qna.html">Q&amp;A</a>
          <a class="" href="board_faq.html">FAQ</a>
          <a class="" href="login.html">로그인</a>
        </nav>
      </div>
    </header>
    <main class="container">
      <div style="text-align: center; margin-bottom: 24px">
        <div class="h1">간편 연말정산 계산</div>
        <p class="p">
          나이와 연봉만으로 평균적인 연말정산 결과를 확인할 수 있습니다.
        </p>
      </div>
      <div class="grid" style="gap: 16px">
        <div class="surface">
          <form action="#" method="post">
            <div class="grid grid-2">
              <div class="field">
                <label>나이</label>
                <input min="0" placeholder="예: 29" type="number" />
                <input id="gender" name="gender" type="hidden" value="" />
                <div class="genderGroup" style="margin-top: 8px">
                  <span class="genderLabel">성별</span>
                  <span
                    aria-label="성별 선택"
                    class="genderToggle"
                    role="group"
                  >
                    <button
                      aria-pressed="false"
                      class="genderBtn"
                      data-gender="M"
                      type="button"
                    >
                      남
                    </button>
                    <button
                      aria-pressed="false"
                      class="genderBtn"
                      data-gender="F"
                      type="button"
                    >
                      녀
                    </button>
                  </span>
                </div>
              </div>
              <div class="field">
                <label>연봉(총급여액)</label>
                <input
                  id="money_"
                  min="0"
                  placeholder="예: 44000000"
                  type="number"
                />
                <div
                  class="btnRow"
                  data-money-controls="1"
                  style="margin-top: 8px"
                >
                  <button
                    class="btn-outline btn-small"
                    onclick="addMoney('money_', 100000)"
                    type="button"
                  >
                    +10만</button
                  ><button
                    class="btn-outline btn-small"
                    onclick="addMoney('money_', 1000000)"
                    type="button"
                  >
                    +100만</button
                  ><button
                    class="btn-outline btn-small"
                    onclick="addMoney('money_', 10000000)"
                    type="button"
                  >
                    +1000만</button
                  ><button
                    class="btn-outline btn-small"
                    onclick="resetMoney('money_')"
                    type="button"
                  >
                    리셋
                  </button>
                </div>
              </div>
            </div>
            <button
              class="btn-primary"
              style="width: 100%; margin-top: 8px"
              type="submit"
            >
              결과 확인
            </button>
          </form>
        </div>
        <div class="surface">
          <div class="h3">예상 결과 (평균 기준)</div>
          <div style="font-size: 26px; font-weight: 800; margin: 12px 0">
            예상 환급액 ± 20만원
          </div>
          <div class="muted" style="margin-bottom: 10px">
            ※ 제한된 정보로 추정한 평균 기반 결과입니다.
          </div>
          <div class="hr"></div>
          <div class="muted" style="margin-bottom: 10px">추천 다음 단계</div>
          <div style="display: flex; gap: 10px; flex-wrap: wrap">
            <a class="btn-ghost" href="detail_income.html"
              >상세 계산으로 이동</a
            >
          </div>
        </div>
      </div>
    </main>
    <footer class="footer">© 2026 TaxSonic. All rights reserved.</footer>
    <script>
      (function () {
        const btn = document.getElementById("hamburgerBtn");
        const drawer = document.getElementById("drawer");
        const backdrop = document.getElementById("drawerBackdrop");
        const closeBtn = document.getElementById("drawerClose");

        function open() {
          drawer && drawer.classList.add("open");
          backdrop && backdrop.classList.add("open");
        }
        function close() {
          drawer && drawer.classList.remove("open");
          backdrop && backdrop.classList.remove("open");
        }
        btn && btn.addEventListener("click", open);
        closeBtn && closeBtn.addEventListener("click", close);
        backdrop && backdrop.addEventListener("click", close);
        // ===== Active highlight (drawer + header nav) =====
        const current = (location.pathname.split("/").pop() || "index.html")
          .split("?")[0]
          .split("#")[0];
        const allLinks = document.querySelectorAll("#drawer .drawerNav a");
        allLinks.forEach((a) => {
          const href = (a.getAttribute("href") || "").trim();
          if (href && href === current) {
            a.classList.add("active");
          }
        });
        const topNavLinks = document.querySelectorAll("header nav a");
        topNavLinks.forEach((a) => {
          const href = (a.getAttribute("href") || "").trim();
          if (href && href === current) {
            a.classList.add("active");
          }
        });

        // ===== Admin visibility (role-based, no toggle) =====
        function getUserRole() {
          const role =
            localStorage.getItem("taxsonic_user_role") ||
            localStorage.getItem("taxsonic_role") ||
            localStorage.getItem("role") ||
            "";
          return String(role).toLowerCase();
        }
        function isLoggedIn() {
          const v =
            localStorage.getItem("taxsonic_is_logged_in") ||
            localStorage.getItem("taxsonic_logged_in") ||
            localStorage.getItem("is_logged_in") ||
            "";
          const hasToken = !!(
            localStorage.getItem("taxsonic_token") ||
            localStorage.getItem("auth_token") ||
            localStorage.getItem("access_token")
          );
          const hasUser = !!(
            localStorage.getItem("taxsonic_user_id") ||
            localStorage.getItem("user_id") ||
            localStorage.getItem("username")
          );
          // If role is set, treat as logged-in for this static prototype.
          const role = getUserRole();
          return (
            v === "1" ||
            v === "true" ||
            hasToken ||
            hasUser ||
            role === "admin" ||
            role === "user"
          );
        }
        function getIsAdmin() {
          const role = getUserRole();
          const legacy = localStorage.getItem("taxsonic_is_admin") === "1"; // backward compat for older builds
          return role === "admin" || legacy;
        }
        function applyAdminVisibility() {
          const showAdmin = isLoggedIn() && getIsAdmin();
          document
            .querySelectorAll('[data-admin-only="true"]')
            .forEach((el) => {
              el.style.display = showAdmin ? "" : "none";
            });
        }
        applyAdminVisibility();

        // ===== User-only visibility (logged-in user only; admin 제외) =====
        function applyUserVisibility() {
          const role = getUserRole();
          const showUser = isLoggedIn() && role === "user";
          document.querySelectorAll('[data-user-only="true"]').forEach((el) => {
            el.style.display = showUser ? "" : "none";
          });
        }
        applyUserVisibility(); // ===== Accordion groups =====
        function setCollapsed(group, collapsed) {
          if (!group) return;
          group.classList.toggle("is-collapsed", !!collapsed);
          const title = group.querySelector(".drawerGroupTitle");
          if (title) {
            title.setAttribute("aria-expanded", collapsed ? "false" : "true");
          }
        }

        const groups = Array.from(
          document.querySelectorAll("#drawer .drawerGroup")
        );
        groups.forEach((group) => {
          const title = group.querySelector(".drawerGroupTitle");
          if (!title) return;

          const name = title.textContent.trim();
          const key = "taxsonic_drawer_group_" + name;

          // make title behave like a button
          title.setAttribute("role", "button");
          title.setAttribute("tabindex", "0");

          const saved = localStorage.getItem(key);
          if (saved === "1") setCollapsed(group, true);

          const toggle = () => {
            const collapsed = group.classList.contains("is-collapsed");
            const next = !collapsed;
            setCollapsed(group, next);
            localStorage.setItem(key, next ? "1" : "0");
          };

          title.addEventListener("click", toggle);
          title.addEventListener("keydown", (e) => {
            if (e.key === "Enter" || e.key === " ") {
              e.preventDefault();
              toggle();
            }
          });
        });

        // Ensure active link's group is open
        const active = document.querySelector("#drawer .drawerNav a.active");
        if (active) {
          const group = active.closest(".drawerGroup");
          if (group) {
            setCollapsed(group, false);
            const title = group.querySelector(".drawerGroupTitle");
            if (title) {
              const key = "taxsonic_drawer_group_" + title.textContent.trim();
              localStorage.setItem(key, "0");
            }
          }
        }
      })();
    </script>
    <script>
      function addMoney(inputId, amount) {
        const el = document.getElementById(inputId);
        if (!el) return;
        const cur =
          parseInt((el.value || "0").toString().replace(/[^0-9-]/g, ""), 10) ||
          0;
        el.value = cur + amount;
        el.dispatchEvent(new Event("input", { bubbles: true }));
      }

      function resetMoney(id) {
        const el = document.getElementById(id);
        if (!el) return;
        el.value = "";
        el.dispatchEvent(new Event("input", { bubbles: true }));
      }

      (function () {
        const hidden = document.getElementById("gender");
        const btns = document.querySelectorAll(".genderBtn");
        if (!btns.length) return;

        function setGender(val) {
          btns.forEach((b) => {
            const on = b.dataset.gender === val;
            b.classList.toggle("active", on);
            b.setAttribute("aria-pressed", on ? "true" : "false");
          });
          if (hidden) hidden.value = val;
        }

        btns.forEach((b) => {
          b.addEventListener("click", () => setGender(b.dataset.gender));
        });
      })();
    </script>
    <script>
      (function () {
        function isLoggedIn() {
          return localStorage.getItem("taxsonic_is_logged_in") === "1";
        }
        function clearAuth() {
          localStorage.removeItem("taxsonic_is_logged_in");
          localStorage.removeItem("taxsonic_user_role");
          localStorage.removeItem("taxsonic_role");
          localStorage.removeItem("role");
          localStorage.removeItem("taxsonic_is_admin"); // legacy
        }

        function enhanceLoginLogoutLinks() {
          const links = Array.from(
            document.querySelectorAll(
              'a[href="login.html"], a[href="./login.html"]'
            )
          );
          if (!links.length) return;

          if (isLoggedIn()) {
            links.forEach((a) => {
              a.setAttribute("href", "#logout");
              a.textContent = "로그아웃";
              a.classList.add("logoutLink");
            });
            document.addEventListener("click", function (e) {
              const a = e.target.closest('a[href="#logout"]');
              if (!a) return;
              e.preventDefault();
              clearAuth();
              window.location.href = "index.html";
            });
          } else {
            links.forEach((a) => {
              a.textContent = "로그인";
              // keep href as login.html
            });
          }
        }

        document.addEventListener("DOMContentLoaded", enhanceLoginLogoutLinks);
      })();
    </script>
  </body>
</html>
